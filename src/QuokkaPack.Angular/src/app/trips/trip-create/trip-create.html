<div class="create-trip-container">
  <div class="page-header">
    <h1>Create Trip</h1>
  </div>

  @if (loading) {
    <p class="loading">Loading…</p>
  } @else {
    <div class="form-wrapper">
      <form (ngSubmit)="onSubmit()" #tripForm="ngForm" class="trip-form">
        @if (error) {
          <div class="alert alert-danger">{{ error }}</div>
        }

        <div class="form-row">
          <div class="form-group">
            <label for="startDate">Start Date</label>
            <input
              type="date"
              id="startDate"
              name="startDate"
              [(ngModel)]="startDateStr"
              required />
          </div>

          <div class="form-group">
            <label for="endDate">End Date</label>
            <input
              type="date"
              id="endDate"
              name="endDate"
              [(ngModel)]="endDateStr"
              required />
          </div>
        </div>

        <div class="form-group">
          <label for="destination">Destination</label>
          <input
            type="text"
            id="destination"
            name="destination"
            [(ngModel)]="trip.destination"
            placeholder="Where are you going?"
            required />
        </div>

        <div class="categories-section">
          <label class="section-label">Select Categories</label>
          <div class="categories-grid">
            @for (category of allCategories; track category.id) {
              <label
                [for]="'category_' + category.id"
                class="category-card"
                [class.selected]="isCategorySelected(category.id)">
                <div class="category-header">
                  <input
                    type="checkbox"
                    [id]="'category_' + category.id"
                    [checked]="isCategorySelected(category.id)"
                    (change)="toggleCategory(category.id)"
                    (click)="$event.stopPropagation()" />
                  <span class="category-name">{{ category.name }}</span>
                </div>
                <div class="category-items">
                  @for (item of getItemsForCategory(category.id); track item.id) {
                    <span class="item-tag">{{ item.name }}</span>
                  } @empty {
                    <span class="no-items">No items</span>
                  }
                </div>
              </label>
            }
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="!tripForm.valid || loading">
            Create Trip
          </button>
          <button type="button" class="btn-outline" (click)="cancel()">
            Cancel
          </button>
        </div>
      </form>

      <div class="back-link">
        <a routerLink="/trips">← Back to Trips</a>
      </div>
    </div>
  }
</div>
