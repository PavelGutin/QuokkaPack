<div class="page-header">
  <h1 class="title">Create Trip</h1>
</div>

@if (loading) {
  <p class="loading">Loadingâ€¦</p>
} @else {
  <div class="row">
    <div class="col-md-4">
      <form (ngSubmit)="onSubmit()" #tripForm="ngForm">
        @if (error) {
          <div class="alert alert-danger">{{ error }}</div>
        }

        <div class="form-group">
          <label for="startDate" class="control-label">Start Date</label>
          <input
            type="date"
            id="startDate"
            name="startDate"
            class="form-control"
            [(ngModel)]="startDateStr"
            required />
        </div>

        <div class="form-group">
          <label for="endDate" class="control-label">End Date</label>
          <input
            type="date"
            id="endDate"
            name="endDate"
            class="form-control"
            [(ngModel)]="endDateStr"
            required />
        </div>

        <div class="form-group">
          <label for="destination" class="control-label">Destination</label>
          <input
            type="text"
            id="destination"
            name="destination"
            class="form-control"
            [(ngModel)]="trip.destination"
            required />
        </div>

        <div>
          <label>Categories:</label>
          @for (category of allCategories; track category.id) {
            <label
              [for]="'category_' + category.id"
              class="d-block border rounded px-3 py-2 mb-2 text-start w-100"
              [class.bg-light]="isCategorySelected(category.id)"
              [class.border-primary]="isCategorySelected(category.id)"
              [class.bg-white]="!isCategorySelected(category.id)"
              style="cursor: pointer;">
              <div class="d-flex align-items-start">
                <input
                  class="form-check-input me-2 mt-1"
                  type="checkbox"
                  [id]="'category_' + category.id"
                  [checked]="isCategorySelected(category.id)"
                  (change)="toggleCategory(category.id)"
                  (click)="$event.stopPropagation()" />

                <div>
                  <div class="fw-bold">{{ category.name }}</div>
                  <div class="small text-muted">
                    @for (item of getItemsForCategory(category.id); track item.id) {
                      <span>{{ item.name }}</span>@if (!$last) {<span>, </span>}
                    } @empty {
                      <span class="fst-italic">No items</span>
                    }
                  </div>
                </div>
              </div>
            </label>
          }
        </div>

        <div class="form-group">
          <button type="submit" class="btn btn-primary" [disabled]="!tripForm.valid || loading">
            Create
          </button>
          <button type="button" class="btn btn-secondary ms-2" (click)="cancel()">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <div>
    <a routerLink="/trips">Back to List</a>
  </div>
}
