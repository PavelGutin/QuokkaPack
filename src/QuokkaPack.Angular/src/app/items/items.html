<div class="container py-4">
  <div class="mb-4 d-flex justify-content-between align-items-center">
    <div>
      <h2>Master List</h2>
      <p class="text-muted">{{ itemCount() }} items</p>
    </div>
    <div>
      <button class="btn btn-outline-secondary" (click)="toggleShowArchived()">
        {{ showArchived() ? 'Hide Archived' : 'Show Archived' }}
      </button>
    </div>
  </div>

  @if (error()) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <span [innerHTML]="error()"></span>
      <button type="button" class="btn-close" (click)="error.set(null)" aria-label="Close"></button>
    </div>
  }

  <div class="row g-3 mb-4">
    <!-- Add New Category -->
    <div class="col-12 col-lg-6">
      <div class="card border-success">
        <div class="card-header bg-success text-white">
          <h3 class="h5 mb-0">Add New Category</h3>
        </div>
        <div class="card-body">
          <form [formGroup]="addCategoryForm" (ngSubmit)="addCategory()" class="row g-2">
            <div class="col">
              <input type="text" formControlName="name" class="form-control" placeholder="Category Name" />
            </div>
            <div class="col-auto">
              <div class="form-check mt-2">
                <input type="checkbox" formControlName="isDefault" class="form-check-input" id="isDefault" />
                <label class="form-check-label" for="isDefault">Default</label>
              </div>
            </div>
            <div class="col-12 col-sm-auto">
              <button type="submit" class="btn btn-success w-100" [disabled]="addCategoryForm.invalid">
                Add Category
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add New Item -->
    <div class="col-12 col-lg-6">
      <div class="card border-primary">
        <div class="card-header bg-primary text-white">
          <h3 class="h5 mb-0">Add New Item</h3>
        </div>
        <div class="card-body">
          <form [formGroup]="addItemForm" (ngSubmit)="addItem()" class="row g-2">
            <div class="col-12 col-sm">
              <input type="text" formControlName="name" class="form-control" placeholder="Item Name" />
            </div>
            <div class="col-12 col-sm">
              <select formControlName="categoryId" class="form-select">
                <option [ngValue]="null" disabled>-- Select Category --</option>
                @for (c of categories(); track c.id) {
                  <option [ngValue]="c.id">{{ c.name }}</option>
                }
              </select>
            </div>
            <div class="col-12 col-sm-auto">
              <button type="submit" class="btn btn-primary w-100" [disabled]="addItemForm.invalid">
                Add Item
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    @for (g of grouped(); track g.key) {
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100" [class.border-secondary]="g.category.isArchived" [class.opacity-75]="g.category.isArchived">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2">
              <span class="fw-semibold">{{ g.category.name }}</span>
              <span class="badge" [class.bg-success]="g.category.isDefault" [class.bg-secondary]="!g.category.isDefault">
                {{ g.category.isDefault ? 'Default' : 'Optional' }}
              </span>
              @if (g.category.isArchived) {
                <span class="badge bg-warning text-dark">Archived</span>
              }
            </div>
            <div class="d-flex gap-1">
              @if (g.category.isArchived) {
                <button
                  class="btn btn-sm btn-outline-primary"
                  title="Restore Category"
                  (click)="restoreCategory(g.category.id!)">
                  â†¶
                </button>
                <button
                  class="btn btn-sm btn-outline-danger"
                  title="Delete Permanently"
                  (click)="removeCategory(g.category.id!)">
                  ðŸ—‘
                </button>
              } @else {
                <button
                  class="btn btn-sm border-0"
                  title="Archive Category"
                  (click)="archiveCategory(g.category.id!)"
                  style="opacity: 0.3; transition: opacity 0.2s;"
                  (mouseenter)="$any($event.target).style.opacity = '1'"
                  (mouseleave)="$any($event.target).style.opacity = '0.3'">ðŸ—‘</button>
              }
            </div>
          </div>

          <div class="card-body">
            @if (g.items.length === 0) {
              <p class="text-muted fst-italic mb-0">No items in this category.</p>
            } @else {
              <div class="list-group list-group-flush">
                @for (it of g.items; track it.id) {
                  <div class="list-group-item d-flex justify-content-between align-items-center px-0"
                       [class.text-muted]="it.isArchived">
                    <div class="d-flex align-items-center gap-2">
                      <span>{{ it.name }}</span>
                      @if (it.isArchived) {
                        <span class="badge bg-warning text-dark small">Archived</span>
                      }
                    </div>
                    <div class="d-flex gap-1">
                      @if (it.isArchived) {
                        <button
                          class="btn btn-sm btn-outline-primary"
                          title="Restore Item"
                          (click)="restoreItem(it.id!)">
                          â†¶
                        </button>
                        <button
                          class="btn btn-sm btn-outline-danger"
                          title="Delete Permanently"
                          (click)="removeItem(it.id!)">
                          ðŸ—‘
                        </button>
                      } @else {
                        <button
                          class="btn btn-sm border-0"
                          title="Archive Item"
                          (click)="archiveItem(it.id!)"
                          style="opacity: 0.3; transition: opacity 0.2s;"
                          (mouseenter)="$any($event.target).style.opacity = '1'"
                          (mouseleave)="$any($event.target).style.opacity = '0.3'">ðŸ—‘</button>
                      }
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    }
  </div>
</div>
